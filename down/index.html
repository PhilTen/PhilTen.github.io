<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="renderer" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
  <meta name="format-detection" content="telephone=no" />
  <title>欢迎使用</title>
  <link rel="stylesheet" href="assets/style.css?v1" />
  <script>
    var iosUri = 'https://apps.apple.com/cn/app/id1197854874';
    var androidUri = 'http://static.heidouw.com/apk/app_release_1.0.8.apk';
    var scheme = "safetalkscheme://safetalkhost"
  </script>
</head>

<body>
  <div class="wrap">
    <div class="welcome">
      <i class="icon"></i>
      <p>欢迎到来<span id="username"></span><br>感谢使用《Safetalk》</p>
    </div>
    <div class="btn-box">
      <a id="downloadBtn" href="javascript:;" class="btn btn-down">下 &nbsp;载</a>
      <a id="openAppBtn" href="javascript:;" class="btn btn-down">打 &nbsp;开</a>
    </div>
  </div>

  <div class="mask">
    <p class="arr"></p>
    <p>如果没有开始下载，请点击右上角的按钮</p>
    <p>选择“在<span id="browser">Safari</span>中打开”，再进行下载</p>
  </div>

  <script src="assets/zepto.js"></script>
  <script src="assets/clipboard.js"></script>
  <script>
    String.prototype.replaceAll = function (reallyDo, replaceWith, ignoreCase) {
      if (!RegExp.prototype.isPrototypeOf(reallyDo)) {
        return this.replace(new RegExp(reallyDo, (ignoreCase ? "gi" : "g")), replaceWith);
      } else {
        return this.replace(reallyDo, replaceWith);
      }
    }

    function geturlattr(key) {
      var url = window.location.search.replace(/\\/g, "/")
      url = url.replaceAll('/u0026', "&")

      var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
      var result = url.substr(1).match(reg);
      return result ? decodeURIComponent(result[2]) : null;
    }

    var username = geturlattr('username');
    if (username) $('#username').text("，" + decodeURIComponent(username));
    else username = ''

    var sUserAgent = navigator.userAgent.toLowerCase();
    var isWexin = sUserAgent.match(/micromessenger/i) == 'micromessenger';

    var isiOS = sUserAgent.match(/iphone/i) == 'iphone';
    var isAndroid = sUserAgent.match(/android/i) == 'android';

    var downloadUrl = '#';
    if (isiOS) {
      downloadUri = iosUri;
      scheme = iosUri;
    } else {
      $('#browser').text('浏览器');
      downloadUri = androidUri;
    }
    $('#downloadBtn').attr('href', downloadUri);
    $('#openAppBtn').attr('href', scheme);


    new ClipboardJS('.btn', {
      text: function () {
        var query = window.location.search.replace(/\\/g, "/");
        query = query.replaceAll('/u0026', "&")
        var code = '#safetalk@' + query.slice(1) + '#';
        //alert(code);
        return code;
      }
    });

    $('.btn-down').click(function () {
      if (isWexin) {
        $('.mask').show();
      }
    });
  </script>
</body>

</html>